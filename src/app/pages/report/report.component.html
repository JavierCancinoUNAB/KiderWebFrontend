<section>
  <h1 class="title mb-3">Reporte de asistencia</h1>
 
  <div class="panel p-3 rounded-3 border border-danger-subtle">
    <div class="d-flex flex-wrap align-items-center gap-2">
      <strong class="text-warning">Fecha:</strong>
      <app-date-picker
        [fechaISO]="fecha()"
        (fechaChange)="onFechaChange($event)"
        aria-label="Selector de fecha para reporte">
      </app-date-picker>
      <div class="ms-2 d-flex gap-2">
        <button class="btn btn-sm btn-outline-secondary"
                (click)="anterior()"
                [disabled]="currentIdx() === -1 || currentIdx() === recentDates().length - 1"
                aria-label="Fecha anterior">
          ← Anterior
        </button>
        <button class="btn btn-sm btn-outline-secondary"
                (click)="siguiente()"
                [disabled]="currentIdx() <= 0"
                aria-label="Fecha siguiente">
          Siguiente →
        </button>
      </div>
      <span class="ms-auto" *ngIf="record()"><strong class="text-success">{{ porcentaje() }}% presentes</strong></span>
    </div>
  </div>

  <div class="mt-3" *ngIf="recentDates().length">
    <h6 class="text-warning">Fechas recientes</h6>
    <div class="d-flex flex-wrap gap-2">
      <button class="btn btn-sm"
              [class.btn-danger]="d === fecha()"
              [class.btn-outline-danger]="d !== fecha()"
              *ngFor="let d of recentDates()"
              (click)="cargar(d)"
              [attr.aria-label]="'Ver reporte de ' + d">
        {{ d }}
      </button>
    </div>
  </div>

  <div class="table-responsive rounded-3 border border-danger-subtle mt-3" *ngIf="record(); else noData">
    <table class="table table-dark table-hover align-middle m-0">
      <thead><tr><th>Alumno</th><th class="text-center">Estado</th><th>Comentario</th></tr></thead>
      <tbody>
        <tr *ngFor="let r of record()!.filas">
          <td>{{ nombreDe(r) }}</td>
          <td class="text-center">
            <span class="badge" [class.bg-success]="r.estado==='PRESENTE'" [class.bg-secondary]="r.estado==='AUSENTE'">{{ r.estado || '—' }}</span>
          </td>
          <td>{{ r.comentario || '—' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noData>
    <p class="text-muted mt-3">No hay registro para la fecha seleccionada.</p>
  </ng-template>
</section>
